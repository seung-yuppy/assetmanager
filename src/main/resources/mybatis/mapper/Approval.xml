<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.example.assetmanager.dao.ApprovalDAO">
	
	<insert id="insertApproval" parameterType="ApprovalDTO" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
		INSERT INTO Approval (approver_id, manager_id, status)
		VALUES (#{approverId}, #{managerId}, 'pending')
	</insert>
	
	<select id="getApprovalById" resultType="ApprovalDTO">
		select *
		from approval
		where id = #{id}
	</select>
	
	<update id="rejectApproval">
		update approval
		set status = #{status}
			,reject_date = #{rejectDate}
			,reject_reason = #{rejectReason}
		where id = #{id}
	</update>
	
	<update id="approveApproval">
		update approval
		set status = #{status},
			<trim suffixOverrides=",">
				<if test="firstApprovalDate != null">first_approval_date = #{firstApprovalDate},</if>
				<if test="lastApprovalDate != null">last_approval_date = #{lastApprovalDate},</if>
			</trim>
		where id = #{id}
	</update>
</mapper>