<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.example.assetmanager.dao.ItemDAO">

	<select id="countAll">
		SELECT COUNT(*)
		FROM Standard_Item s
		<where>
			<if test="categoryId != 0 and categoryId != ''">
				category_id = #{categoryId}
			</if>
			<if test="keyword != null and keyword != ''">
				item_name LIKE '%' || #{keyword} || '%'
			</if>
		</where>
	</select>
	
	<select id="listAll">
		SELECT *
		FROM (
            SELECT ROWNUM rnum, si.*
            FROM (
                SELECT *
                FROM Standard_Item
                JOIN Category ON Standard_Item.category_id = Category.id
                <where>
					<if test="categoryId != 0 and categoryId != ''">
						category_id = #{categoryId}
					</if>
					<if test="keyword != null and keyword != ''">
						item_name LIKE '%' || #{keyword} || '%'
					</if>
				</where>
                ORDER BY Standard_Item.id
            ) si
        )
        OFFSET #{offset} ROWS
        FETCH NEXT #{size} ROWS ONLY
	</select>
	
	<insert id="addItem">
		INSERT INTO Standard_Item (category_id, item_name, price, seller, maker, spec)
		VALUES (#{item.categoryId}, #{item.itemName}, #{item.price}, #{item.seller}, #{item.maker}, #{item.spec})
	</insert>
	
	<delete id="removeItem">
	 	DELETE FROM Standard_Item
	 	WHERE id = #{id}
	</delete>
	
	<select id="getItemsByCategory" parameterType="int" resultType="ItemDTO">
		SELECT *
		FROM Standard_Item
		WHERE category_id = #{id}
	</select>
	
</mapper>