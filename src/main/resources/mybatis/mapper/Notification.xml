<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.example.assetmanager.dao.NotificationDAO">
	
	<insert id="insert" parameterType="NotificationDTO">
		INSERT INTO Notification (user_id,target_type, target_id, message)
		VALUES (#{userId}, #{targetType}, #{targetId}, #{message})
	</insert>
	
	<select id="getListByUserId" parameterType="int" resultType="NotificationDTO">
		select *
		from notification n
		where n.user_id = #{userId}
			  and n.create_date >= SYSDATE - 7
		order by n.create_date DESC
		offset #{offset} rows
		fetch next 10 rows only
	</select>
	
	<select id="getUnreadCountByUserId">
		select count(*)
		from notification
		where user_id = #{id} and is_read = 0
			  and create_date >= SYSDATE - 7
	</select>
	
	<update id="readById">
		update notification
		set is_read = 1
		where id = #{id}
	</update>
	
	<update id="readAll">
		update notification
		set is_read = 1
		where user_id = #{userId}
	</update>
</mapper>